{"version":3,"file":"index.esm.js","sources":["../../src/serializer.ts","../../src/canonicalize.ts","../../src/canonicalize-ex.ts"],"sourcesContent":["export interface ISerializeOptions {\n  allowCircular?: boolean;\n  include?: string[];\n  exclude?: string | string[];\n  filterUndefined?: boolean;\n  undefinedInArrayToNull?: boolean;\n}\n\nexport function _serialize(obj: any, options?: ISerializeOptions) {\n  let buffer = '';\n  const vInclude = options && options.include;\n  let vExclude = options && options.exclude;\n  if (vExclude) {\n    if (typeof vExclude === 'string') vExclude = [vExclude];\n  }\n  if (vInclude) vInclude.sort();\n\n  const visited = new WeakMap<object, string>();\n  const allowCircular = options && options.allowCircular;\n  const filterUndefined = options && options.filterUndefined;\n  const undefinedInArrayToNull = options && options.undefinedInArrayToNull;\n\n  serialize(obj, '');\n\n  return buffer;\n\n  function serialize(object: any, path: string) {\n    if (\n      object === null ||\n      typeof object !== 'object' ||\n      object.toJSON != null\n    ) {\n      /////////////////////////////////////////////////\n      // Primitive data type - Use ES6/JSON          //\n      /////////////////////////////////////////////////\n      buffer += JSON.stringify(object);\n\n    } else if (Array.isArray(object)) {\n      /////////////////////////////////////////////////\n      // Array - Maintain element order              //\n      /////////////////////////////////////////////////\n      const visitedPath = visited.get(object);\n      if (visitedPath !== undefined) {\n        if (path.startsWith(visitedPath)) {\n          if (!allowCircular) {\n            throw new Error('Circular reference detected');\n          }\n          buffer += '\"[Circular]\"';\n\n          return;\n        }\n      }\n      visited.set(object, path);\n\n      buffer += '[';\n      let next = false;\n      object.forEach((element, index) => {\n        if (next) {\n          buffer += ',';\n        }\n        next = true;\n        if (undefinedInArrayToNull && element === undefined) {\n          element = null;\n        }\n        /////////////////////////////////////////\n        // Array element - Recursive expansion //\n        /////////////////////////////////////////\n        serialize(element, `${path}[${index}]`);\n      });\n      buffer += ']';\n    } else {\n      /////////////////////////////////////////////////\n      // Object - Sort properties before serializing //\n      /////////////////////////////////////////////////\n      const visitedPath = visited.get(object);\n      if (visitedPath !== undefined) {\n        if (path.startsWith(visitedPath)) {\n          if (!allowCircular) {\n            throw new Error('Circular reference detected');\n          }\n          buffer += '\"[Circular]\"';\n\n          return;\n        }\n      }\n      visited.set(object, path);\n\n      buffer += '{';\n      let next = false;\n\n      const addProp = (property: string) => {\n        if (vExclude && (vExclude as string[]).includes(property)) {\n          return;\n        }\n\n        if (next) {\n          buffer += ',';\n        }\n        next = true;\n        ///////////////////////////////////////////////\n        // Property names are strings - Use ES6/JSON //\n        ///////////////////////////////////////////////\n        buffer += JSON.stringify(property);\n        buffer += ':';\n        //////////////////////////////////////////\n        // Property value - Recursive expansion //\n        //////////////////////////////////////////\n        serialize(object[property], `${path}.${property}`);\n      };\n\n      if (path === '' && vInclude) {\n        vInclude.forEach((property) => {\n          if (object.hasOwnProperty(property)) {\n            addProp(property);\n          }\n        });\n      } else {\n        let vKeys = Object.keys(object);\n        if (filterUndefined) {\n          vKeys = vKeys.filter((k) => object[k] !== undefined);\n        }\n        vKeys.sort();\n        vKeys.forEach((property) => {\n          addProp(property);\n        });\n      }\n      buffer += '}';\n    }\n  }\n}\n","import { _serialize } from './serializer';\n\n/**\n * The main function for JSON canonicalization. It takes a JavaScript object and returns its canonical string representation.\n *\n * @param obj The JavaScript object to canonicalize.\n * @param allowCircular If `true`, the function will handle circular references in the object by replacing them with `null`. Defaults to `false`.\n * @returns The canonical string representation of the object.\n */\nexport function canonicalize(obj: any, allowCircular?: boolean) {\n  return _serialize(obj, {\n    allowCircular,\n    filterUndefined: true,\n    undefinedInArrayToNull: true,\n  });\n}\n","import { ISerializeOptions, _serialize } from './serializer';\n\n/**\n * The extended canonicalization function, offering more granular control over the serialization process.\n *\n * @param obj The JavaScript object to canonicalize.\n * @param options An object with the following properties:\n *  - `allowCircular` (boolean, optional): Same as in `canonicalize`.\n *  - `filterUndefined` (boolean, optional): If `true`, `undefined` values in objects will be filtered out. Defaults to `true`.\n *  - `undefinedInArrayToNull` (boolean, optional): If `true`, `undefined` values in arrays will be converted to `null`. Defaults to `true`.\n *  - `include` (string[], optional): An array of property names to include in the canonicalization.\n *  - `exclude` (string[], optional): An array of property names to exclude from the canonicalization.\n * @returns The canonical string representation of the object.\n */\nexport function canonicalizeEx(obj: any, options?: ISerializeOptions) {\n  return _serialize(obj, options);\n}\n"],"names":[],"mappings":"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"}