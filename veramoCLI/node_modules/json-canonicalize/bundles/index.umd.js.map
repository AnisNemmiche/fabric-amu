{"version":3,"file":"index.umd.js","sources":["../../src/serializer.ts","../../src/canonicalize.ts","../../src/canonicalize-ex.ts"],"sourcesContent":["export interface ISerializeOptions {\n  allowCircular?: boolean;\n  include?: string[];\n  exclude?: string | string[];\n  filterUndefined?: boolean;\n  undefinedInArrayToNull?: boolean;\n}\n\nexport function _serialize(obj: any, options?: ISerializeOptions) {\n  let buffer = '';\n  const vInclude = options && options.include;\n  let vExclude = options && options.exclude;\n  if (vExclude) {\n    if (typeof vExclude === 'string') vExclude = [vExclude];\n  }\n  if (vInclude) vInclude.sort();\n\n  const visited = new WeakMap<object, string>();\n  const allowCircular = options && options.allowCircular;\n  const filterUndefined = options && options.filterUndefined;\n  const undefinedInArrayToNull = options && options.undefinedInArrayToNull;\n\n  serialize(obj, '');\n\n  return buffer;\n\n  function serialize(object: any, path: string) {\n    if (\n      object === null ||\n      typeof object !== 'object' ||\n      object.toJSON != null\n    ) {\n      /////////////////////////////////////////////////\n      // Primitive data type - Use ES6/JSON          //\n      /////////////////////////////////////////////////\n      buffer += JSON.stringify(object);\n\n    } else if (Array.isArray(object)) {\n      /////////////////////////////////////////////////\n      // Array - Maintain element order              //\n      /////////////////////////////////////////////////\n      const visitedPath = visited.get(object);\n      if (visitedPath !== undefined) {\n        if (path.startsWith(visitedPath)) {\n          if (!allowCircular) {\n            throw new Error('Circular reference detected');\n          }\n          buffer += '\"[Circular]\"';\n\n          return;\n        }\n      }\n      visited.set(object, path);\n\n      buffer += '[';\n      let next = false;\n      object.forEach((element, index) => {\n        if (next) {\n          buffer += ',';\n        }\n        next = true;\n        if (undefinedInArrayToNull && element === undefined) {\n          element = null;\n        }\n        /////////////////////////////////////////\n        // Array element - Recursive expansion //\n        /////////////////////////////////////////\n        serialize(element, `${path}[${index}]`);\n      });\n      buffer += ']';\n    } else {\n      /////////////////////////////////////////////////\n      // Object - Sort properties before serializing //\n      /////////////////////////////////////////////////\n      const visitedPath = visited.get(object);\n      if (visitedPath !== undefined) {\n        if (path.startsWith(visitedPath)) {\n          if (!allowCircular) {\n            throw new Error('Circular reference detected');\n          }\n          buffer += '\"[Circular]\"';\n\n          return;\n        }\n      }\n      visited.set(object, path);\n\n      buffer += '{';\n      let next = false;\n\n      const addProp = (property: string) => {\n        if (vExclude && (vExclude as string[]).includes(property)) {\n          return;\n        }\n\n        if (next) {\n          buffer += ',';\n        }\n        next = true;\n        ///////////////////////////////////////////////\n        // Property names are strings - Use ES6/JSON //\n        ///////////////////////////////////////////////\n        buffer += JSON.stringify(property);\n        buffer += ':';\n        //////////////////////////////////////////\n        // Property value - Recursive expansion //\n        //////////////////////////////////////////\n        serialize(object[property], `${path}.${property}`);\n      };\n\n      if (path === '' && vInclude) {\n        vInclude.forEach((property) => {\n          if (object.hasOwnProperty(property)) {\n            addProp(property);\n          }\n        });\n      } else {\n        let vKeys = Object.keys(object);\n        if (filterUndefined) {\n          vKeys = vKeys.filter((k) => object[k] !== undefined);\n        }\n        vKeys.sort();\n        vKeys.forEach((property) => {\n          addProp(property);\n        });\n      }\n      buffer += '}';\n    }\n  }\n}\n","import { _serialize } from './serializer';\n\n/**\n * The main function for JSON canonicalization. It takes a JavaScript object and returns its canonical string representation.\n *\n * @param obj The JavaScript object to canonicalize.\n * @param allowCircular If `true`, the function will handle circular references in the object by replacing them with `null`. Defaults to `false`.\n * @returns The canonical string representation of the object.\n */\nexport function canonicalize(obj: any, allowCircular?: boolean) {\n  return _serialize(obj, {\n    allowCircular,\n    filterUndefined: true,\n    undefinedInArrayToNull: true,\n  });\n}\n","import { ISerializeOptions, _serialize } from './serializer';\n\n/**\n * The extended canonicalization function, offering more granular control over the serialization process.\n *\n * @param obj The JavaScript object to canonicalize.\n * @param options An object with the following properties:\n *  - `allowCircular` (boolean, optional): Same as in `canonicalize`.\n *  - `filterUndefined` (boolean, optional): If `true`, `undefined` values in objects will be filtered out. Defaults to `true`.\n *  - `undefinedInArrayToNull` (boolean, optional): If `true`, `undefined` values in arrays will be converted to `null`. Defaults to `true`.\n *  - `include` (string[], optional): An array of property names to include in the canonicalization.\n *  - `exclude` (string[], optional): An array of property names to exclude from the canonicalization.\n * @returns The canonical string representation of the object.\n */\nexport function canonicalizeEx(obj: any, options?: ISerializeOptions) {\n  return _serialize(obj, options);\n}\n"],"names":[],"mappings":"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"}